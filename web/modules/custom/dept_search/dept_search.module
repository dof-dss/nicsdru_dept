<?php

/**
 * @file
 * Search related overrides and preprocessing.
 */

use Drupal\facets\FacetInterface;

/**
 * Implements hook_form_FORM_ID_alter().
 */
function dept_search_form_search_api_form_alter(&$form) {
  $form['query']['#attributes']['placeholder'] = t('Search this site...');
}

/**
 * Implements hook_preprocess_block().
 */
function dept_search_preprocess_block(&$variables) {
  // Look for the 'social sharing' block.
  if (preg_match('/consultations_search-consultations_search/', $variables['plugin_id'])) {
    $variables['content']['preamble'] = [
      '#type' => 'html_tag',
      '#tag' => 'div',
      '#value' => t('Search consultations and choose filters to show only the results you want'),
      '#weight' => -1,
    ];
  }

  if (preg_match('/press_release_search-pr_search_page/', $variables['plugin_id'])) {
    $variables['content']['preamble'] = [
      '#type' => 'html_tag',
      '#tag' => 'div',
      '#value' => t('Search news releases and choose filters to show only the results you want'),
      '#weight' => -1,
    ];
  }
}

/**
 * Implements hook_preprocess_facets_item_list().
 */
function dept_search_preprocess_facets_item_list(array &$variables) {
  /** @var \Drupal\facets\FacetInterface $facet */
  $facet = $variables['facet'];

  if ($facet->id() === 'group' && !empty($variables['items'])) {
    $depts = \Drupal::service('department.manager')->getAllDepartments();
    foreach ($variables['items'] as &$link) {
      $facet_group_id = $link['#title']['#raw_value'];
      foreach ($depts as $dept) {
        /** @var \Drupal\dept_core\Department $dept */
        if ($dept->groupId() === $facet_group_id) {
          // Replace the group id value with the dept name.
          $link['#title']['#value'] = $dept->name();
        }
      }
    }
  }
}
