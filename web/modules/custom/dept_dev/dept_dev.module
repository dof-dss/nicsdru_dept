<?php

/**
 * @file
 * Primary module hooks for dept_dev module.
 *
 * @DCG
 * This file is no longer required in Drupal 8.
 * @see https://www.drupal.org/node/2217931
 */

use Drupal\Core\Url;
use Drupal\dept_dev\DeptDevLazyBuilders;

/**
 * Implements hook_toolbar().
 */
function dept_dev_toolbar() {
  $items = [];

  $domains = [
    'Departmental' => [
      'dept.lndo.site',
      'https://www.main-bvxea6i-dnvkwx4xjhiza.uk-1.platformsh.site'
    ],
    'NI Gov' => [
      'nigov.lndo.site',
      'https://northernireland.gov.uk'
    ],
    'Communities' => [
      'communities-ni.lndo.site',
      'https://communities-ni.gov.uk'
    ],
    'DAERA' => [
      'daera-ni.lndo.site',
      'https://daera-ni.gov.uk'
    ],
    'Economy' => [
      'economy-ni.lndo.site',
      'https://economy-ni.gov.uk'
    ],
    'Education' => [
      'education-ni.lndo.site',
      'https://education-ni.gov.uk'
    ],
    'Executive Office' => [
      'executiveoffice-ni.lndo.site',
      'https://executiveoffice-ni.gov.uk'
    ],
    'Finance' => [
      'finance-ni.lndo.site',
      'https://finance-ni.gov.uk'
    ],
    'Health' => [
      'health-ni.lndo.site',
      'https://health-ni.gov.uk'
    ],
    'Infrastructure' => [
      'infrastructure-ni.lndo.site',
      'https://infrastructure-ni.gov.uk'
    ],
    'Justice' => [
      'justice-ni.lndo.site',
      'https://justice-ni.gov.uk'
    ],
  ];

  $lando_hostnames = \Drupal::config('dept_dev.settings.toolbar_sites')->get('lando_hostname');
  $lando_protocol = \Drupal::config('dept_dev.settings.toolbar_sites')->get('lando_protocol');
  $protocol = ($lando_protocol) ? 'http://' : 'https://';
  $links = [];

  foreach ($domains as $name => $urls) {

    if ($lando_hostnames) {
      $url = $protocol . $urls[0];
    }
    else {
      $url = $urls[1];
    }

    $links[] = [
      'title' => $name,
      'url' => Url::fromUri($url),
    ];
  }

  $menu_links = [
    '#theme' => 'links__toolbar_sites',
    '#links' => $links,
    '#attributes' => [
      'class' => ['toolbar-menu'],
    ],
  ];

  $items['sites'] = [
    '#type' => 'toolbar_item',
    'tab' => [
      '#type' => 'link',
      '#title' => t('Sites'),
      '#url' => Url::fromRoute('domain.admin'),
      '#attributes' => [
        'title' => t('Departmental sites'),
        'class' => ['toolbar-icon', 'toolbar-icon-menu'],
      ],
    ],
    'tray' => [
      '#heading' => t('Departmental sites'),
      'children' => $menu_links,
      'configuration' => [
        '#type' => 'link',
        '#title' => 'Configure',
        '#url' => Url::fromRoute('dept_dev.settings.toolbar.sites'),
        // Just borrowing 'Shortcuts' class to move this link to the right.
        '#attributes' => ['class' => ['edit-shortcuts']],
      ],
    ],
    '#cache' => [
      'tags' => ['dept_dev_tools_sites'],
    ],
    '#weight' => 100,
  ];

  return $items;
}
