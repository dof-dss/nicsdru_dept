version: 2.1
setup: true

parameters:
  php_version:
    type: string
    default: "8.3"
  node_version:
    type: string
    default: "14.21.3"
  drupal_core_version:
    type: string
    default: "10.4"

jobs:
  continue_config:
    docker:
      - image: cimg/base:stable
    steps:
      - run:
          name: Install CircleCI CLI (manual download)
          command: |
            mkdir -p ~/.local/bin
            curl -Lo ~/.local/bin/circleci https://github.com/CircleCI-Public/circleci-cli/releases/latest/download/circleci-linux-amd64
            chmod +x ~/.local/bin/circleci
            echo 'export PATH="$HOME/.local/bin:$PATH"' >> $BASH_ENV
            source $BASH_ENV
      - run:
          name: Download shared config and continue
          command: |
            curl -fsSL https://raw.githubusercontent.com/johangant/ci-config/refs/heads/DEPT-1217--shared-config/shared-config.yml -o /tmp/continuation.yml
            circleci pipeline continue \
              -c /tmp/continuation.yml \
              -p '{
                "php_version": "<< pipeline.parameters.php_version >>",
                "node_version": "<< pipeline.parameters.node_version >>",
                "drupal_core_version": "<< pipeline.parameters.drupal_core_version >>"
              }'

workflows:
  setup:
    jobs:
      - continue_config
